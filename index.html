<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω B√°n H√†ng T·∫øt - HUST</title>
    <style>
        :root { --tet-red: #d32f2f; --tet-gold: #ffeb3b; --bg-xuan: #fffaf0; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: var(--bg-xuan); margin: 0; padding: 15px; color: #333; }
        .container { max-width: 800px; margin: auto; }
        
        /* M√ÄN H√åNH KH√ìA M√ÅY CH·ª¶ */
        #lockScreen { position:fixed; top:0; left:0; width:100%; height:100%; background:var(--tet-red); z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white; text-align:center; padding:20px; }
        
        .box { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 15px; border-left: 5px solid var(--tet-red); }
        h2, h3 { color: var(--tet-red); margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        
        input, select, button { padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; font-size: 14px; }
        button { background: var(--tet-red); color: white; font-weight: bold; cursor: pointer; border: none; transition: 0.2s; }
        button:hover { background: #b71c1c; }
        
        /* G·ª£i √Ω kh√°ch h√†ng */
        .search-container { position: relative; }
        .suggestions { position: absolute; background: white; width: 100%; z-index: 100; border: 1px solid #ddd; max-height: 150px; overflow-y: auto; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .suggestion-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; text-align: left; color: #333; }
        .suggestion-item:hover { background: #fff9c4; }

        /* B·∫£ng h√†ng h√≥a */
        table { width: 100%; border-collapse: collapse; margin: 10px 0; background: #fff; }
        th, td { border: 1px solid #eee; padding: 8px; text-align: center; }
        th { background: #fdf2f2; color: var(--tet-red); }
        .btn-x { background: #ff5252; width: auto; padding: 2px 8px; border-radius: 4px; }

        /* ƒê∆°n ghim ƒë·∫∑c bi·ªát */
        .priority { background-color: #ffebee !important; border: 2px solid #ff5252 !important; order: -1; position: relative; }
        .priority::before { content: "üìå ƒê∆†N ∆ØU TI√äN"; position: absolute; top: -10px; right: 10px; background: red; color: white; padding: 2px 8px; font-size: 10px; border-radius: 10px; z-index:10; }
        
        .order-card { padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; background: white; display: flex; flex-direction: column; }
        .flex-group { display: flex; gap: 8px; }
        .total-text { font-size: 18px; font-weight: bold; color: var(--tet-red); text-align: right; }
    </style>
</head>
<body>

<!-- M√ÄM H√åNH KH√ìA -->
<div id="lockScreen">
    <h1>üßß M√ÅY CH·ª¶ 8A üßß</h1>
    <p>Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u m√°y ch·ªß</p>
    <input type="text" id="serverPass" style="width:250px; text-align:center; color: #000;" placeholder="Nh·∫≠p m·∫≠t kh·∫©u...">
    <button onclick="checkAccess()" style="width:250px; background:var(--tet-gold); color:black; margin-top:10px;">X√ÅC NH·∫¨N</button>
</div>

<div class="container">
    <h2>üßß QU·∫¢N L√ù B√ÅN H√ÄNG 8A üßß</h2>

    <div class="box">
        <h3>üì¶ Danh m·ª•c S·∫£n ph·∫©m (G·ªëc)</h3>
        <div class="flex-group">
            <input type="text" id="setupTen" placeholder="T√™n m√≥n">
            <input type="number" id="setupVon" placeholder="Gi√° v·ªën">
            <input type="number" id="setupBan" placeholder="Gi√° b√°n">
            <button onclick="addGlobalProduct()" style="width: 120px;">L∆∞u</button>
        </div>
        <table id="tableMenu">
            <thead><tr><th>M√≥n</th><th>B√°n</th><th>L√£i/M√≥n</th><th>X√≥a</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="box">
        <h3>üìù L√™n ƒê∆°n M·ªõi</h3>
        <div class="search-container">
            <input type="text" id="khTen" placeholder="Nh·∫≠p t√™n kh√°ch..." onkeyup="showSearch(this.value)">
            <div id="boxGoiY" class="suggestions" style="display:none"></div>
        </div>
        <input type="text" id="khLop" placeholder="Nh·∫≠p l·ªõp">
        
        <div class="flex-group" style="align-items: center;">
            <select id="selectSP" style="flex: 2;"></select>
            <input type="number" id="inpSL" value="1" min="1" style="flex: 0.5; text-align: center;">
            <button onclick="addToCart()" style="flex: 1; background: #388e3c;">+ Th√™m</button>
        </div>

        <table>
            <thead><tr><th>M√≥n</th><th>SL</th><th>T·ªïng</th><th>#</th></tr></thead>
            <tbody id="cartBody"></tbody>
        </table>
        <p class="total-text">T·ªïng: <span id="cartTotal">0</span> ƒë</p>
        <button onclick="checkout()" style="height: 50px; font-size: 18px; background: #1976d2;">‚úÖ HO√ÄN TH√ÄNH ƒê∆†N</button>
    </div>

    <div class="box">
        <h3>üìä L·ªãch S·ª≠ Kh√°ch H√†ng</h3>
        <div id="historyList" style="display: flex; flex-direction: column;"></div>
    </div>
</div>

<script>
    const MASTER_KEY = "big family 8A"; // M·∫≠t kh·∫©u c·ªßa b·∫°n
    let products = JSON.parse(localStorage.getItem('p_8a')) || [];
    let history = JSON.parse(localStorage.getItem('h_8a')) || [];
    let cart = [];

    function checkAccess() {
        if(document.getElementById('serverPass').value === MASTER_KEY) {
            document.getElementById('lockScreen').style.display = 'none';
        } else { alert("Sai m·∫≠t kh·∫©u m√°y ch·ªß!"); }
    }

    function addGlobalProduct() {
        const ten = document.getElementById('setupTen').value.trim();
        const von = Number(document.getElementById('setupVon').value);
        const ban = Number(document.getElementById('setupBan').value);
        if(!ten || !ban) return alert("Thi·∫øu th√¥ng tin!");
        products.push({ ten, von, ban });
        save();
        document.getElementById('setupTen').value=''; document.getElementById('setupVon').value=''; document.getElementById('setupBan').value='';
    }

    function addToCart() {
        const idx = document.getElementById('selectSP').value;
        const sl = Number(document.getElementById('inpSL').value);
        if(idx === "" || sl < 1) return;
        const sp = products[idx];
        const ex = cart.find(i => i.ten === sp.ten);
        if(ex) ex.sl += sl; else cart.push({...sp, sl});
        renderCart();
    }

    function renderCart() {
        let t = 0;
        document.getElementById('cartBody').innerHTML = cart.map((item, i) => {
            t += (item.ban * item.sl);
            return `<tr><td>${item.ten}</td><td>${item.sl}</td><td>${(item.ban*item.sl).toLocaleString()}</td>
            <td><button class="btn-x" onclick="cart.splice(${i},1);renderCart()">X</button></td></tr>`;
        }).join('');
        document.getElementById('cartTotal').innerText = t.toLocaleString();
    }

    function showSearch(val) {
        const box = document.getElementById('boxGoiY');
        if(!val) { box.style.display='none'; return; }
        const unique = []; const seen = new Set();
        history.forEach(h => { if(!seen.has(h.ten+h.lop)){ seen.add(h.ten+h.lop); unique.push(h); }});
        const filter = unique.filter(k => k.ten.toLowerCase().includes(val.toLowerCase()));
        box.innerHTML = filter.map(k => `<div class="suggestion-item" onclick="pick('${k.ten}','${k.lop}')">${k.ten} - <b>${k.lop}</b></div>`).join('');
        box.style.display = filter.length ? 'block' : 'none';
    }

    function pick(t, l) {
        document.getElementById('khTen').value = t;
        document.getElementById('khLop').value = l;
        document.getElementById('boxGoiY').style.display='none';
    }

    function checkout() {
        const ten = document.getElementById('khTen').value.trim();
        const lop = document.getElementById('khLop').value.trim();
        if(!ten || !lop || cart.length === 0) return alert("Thi·∫øu th√¥ng tin!");
        const tTien = cart.reduce((s, i) => s + (i.ban * i.sl), 0);
        const tVon = cart.reduce((s, i) => s + (i.von * i.sl), 0);
        const monStr = cart.map(i => `${i.ten}(x${i.sl})`).join(', ');

        const oldIdx = history.findIndex(h => h.ten === ten && h.lop === lop);
        if(oldIdx !== -1) {
            history[oldIdx].monAn += ", " + monStr;
            history[oldIdx].tongTien += tTien;
            history[oldIdx].tongLai += (tTien - tVon);
            if(history[oldIdx].tongTien >= 100000) history[oldIdx].isPinned = true;
        } else {
            history.push({ id: Date.now(), ten, lop, monAn: monStr, tongTien: tTien, tongLai: (tTien-tVon), isPinned: tTien >= 100000 });
        }
        cart = []; renderCart(); save();
        document.getElementById('khTen').value=''; document.getElementById('khLop').value='';
        alert("ƒê√£ l∆∞u ƒë∆°n!");
    }

    function save() {
        localStorage.setItem('p_8a', JSON.stringify(products));
        localStorage.setItem('h_8a', JSON.stringify(history));
        renderAll();
    }

    function renderAll() {
        document.querySelector('#tableMenu tbody').innerHTML = products.map((p, i) => `
            <tr><td>${p.ten}</td><td>${p.ban}</td><td>${p.ban-p.von}</td>
            <td><button class="btn-x" onclick="products.splice(${i},1);save()">X</button></td></tr>
        `).join('');
        document.getElementById('selectSP').innerHTML = products.map((p, i) => `<option value="${i}">${p.ten}</option>`).join('');
        const sorted = [...history].sort((a,b) => b.isPinned - a.isPinned);
        document.getElementById('historyList').innerHTML = sorted.map(h => `
            <div class="order-card ${h.isPinned ? 'priority' : ''}">
                <b>${h.ten} - ${h.lop}</b>  
                <div style="font-size:12px; color:#666;">ƒê√£ mua: ${h.monAn}</div>
                <div style="font-weight:bold;">Doanh thu: <span style="color:red">${h.tongTien.toLocaleString()}ƒë</span> | L√£i: <span style="color:green">${h.tongLai.toLocaleString()}ƒë</span></div>
                <div class="flex-group" style="margin-top:10px;">
                    <button onclick="const i=history.find(x=>x.id===${h.id});i.isPinned=!i.isPinned;save()" style="background:#546e7a; font-size:11px;">Ghim/H·∫°</button>  
                    <button onclick="history=history.filter(x=>x.id!==${h.id});save()" style="background:#444; font-size:11px;">X√≥a</button>
                </div>
            </div>
        `).join('');
    }
    renderAll();
</script>
</body>
</html>
                                                                                                                                                                                                                                                              
