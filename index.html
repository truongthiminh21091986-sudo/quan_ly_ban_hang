<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>8A - QU·∫¢N L√ù T·∫æT 2026</title>
    <style>
        :root { --tet-red: #d32f2f; --tet-gold: #ffeb3b; --bg-xuan: #fffaf0; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: var(--bg-xuan); margin: 0; padding: 0; touch-action: manipulation; }
        #lock-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #ff5252, #b71c1c); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; color: var(--tet-gold); }
        .lock-box { width: 90%; max-width: 350px; padding: 25px; border-radius: 15px; border: 3px solid var(--tet-gold); background: rgba(0,0,0,0.1); text-align: center; }
        .pass-row { display: flex; background: white; border-radius: 10px; margin: 20px 0; overflow: hidden; height: 55px; align-items: center; }
        #passInput { flex: 1; border: none; padding: 0 15px; font-size: 18px; outline: none; height: 100%; color: #333; }
        .eye-touch { width: 70px; height: 100%; background: #f0f0f0; border-left: 2px solid #ddd; font-size: 28px; display: flex; align-items: center; justify-content: center; cursor: pointer; -webkit-tap-highlight-color: transparent; }
        .btn-unlock { width: 100%; padding: 15px; border-radius: 10px; background: var(--tet-gold); color: #b71c1c; font-weight: bold; font-size: 20px; cursor: pointer; text-align: center; }
        #app-container { max-width: 800px; margin: auto; padding: 10px; display: none; }
        .box { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 15px; border-left: 8px solid var(--tet-red); }
        input, select { padding: 12px; margin: 5px 0; border-radius: 8px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; font-size: 16px; }
        .btn-app { padding: 15px; background: var(--tet-red); color: white; border-radius: 10px; text-align: center; font-weight: bold; margin: 5px 0; cursor: pointer; }
        .customer-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .btn-history { background: #1976d2; color: white; border: none; padding: 6px 10px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 12px; }
        .filter-container { display: flex; justify-content: flex-end; gap: 5px; margin-bottom: 10px; overflow-x: auto; }
        .btn-day { padding: 6px 12px; border-radius: 20px; border: 1px solid var(--tet-red); background: #fff; color: var(--tet-red); font-weight: bold; font-size: 12px; cursor: pointer; white-space: nowrap; }
        .btn-day.active { background: var(--tet-red); color: #fff; }
        #popHistory { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; padding: 20px; box-sizing: border-box; }
        .pop-box { background: white; max-width: 500px; margin: auto; padding: 20px; border-radius: 15px; max-height: 80vh; overflow-y: auto; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 10px; }
        .stat-item { padding: 10px; border-radius: 10px; text-align: center; color: white; font-size: 11px; font-weight: bold; }
        .cart-item { display: inline-flex; align-items: center; background: #e8f5e9; color: #2e7d32; padding: 5px 10px; border-radius: 20px; margin: 3px; font-size: 13px; border: 1px solid #c8e6c9; }
        .cart-del { color: #d32f2f; margin-left: 8px; font-weight: bold; cursor: pointer; padding: 0 5px; }
        .menu-row { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px dashed #ddd; font-size: 13px; }
    </style>
</head>
<body>

<div id="lock-screen">
    <div class="lock-box">
        <h1 style="margin:0; font-size: 26px;">üßß BIG FAMILY 8A üßß</h1>
        <div class="pass-row">
            <input type="password" id="passInput" placeholder="M·∫≠t kh·∫©u...">
            <div class="eye-touch" onpointerdown="togglePass(event)">üëÅÔ∏è</div>
        </div>
        <div class="btn-unlock" onpointerdown="unlock(event)">M·ªû C·ª¨A ƒê√ìN L·ªòC</div>
    </div>
</div>

<div id="popHistory">
    <div class="pop-box">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 id="popTitle">Chi ti·∫øt</h3>
            <b onpointerdown="document.getElementById('popHistory').style.display='none'" style="cursor:pointer; font-size:20px;">‚úñ</b>
        </div>
        <div id="popContent" style="margin-top:15px;"></div>
    </div>
</div>

<div id="app-container">
    <div class="box" style="display:flex; justify-content:space-between; align-items:center; background:var(--tet-red); color:white;">
        <b>üèÆ QU·∫¢N L√ù 8A (ANTI-CRASH)</b>
        <div onpointerdown="location.reload()" style="background:var(--tet-gold); color:#b71c1c; padding:5px; border-radius:5px; cursor:pointer;">KH√ìA</div>
    </div>

    <div class="box">
        <h3>üì¶ Danh m·ª•c m√≥n</h3>
        <input type="text" id="setupTen" placeholder="T√™n m√≥n">
        <input type="number" id="setupBan" placeholder="Gi√° b√°n">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 5px;">
            <input type="number" id="setupVon" placeholder="V·ªën">
            <input type="number" id="setupLai" placeholder="L√£i">
        </div>
        <div class="btn-app" onpointerdown="addProd(event)">L∆ØU M√ìN G·ªêC</div>
        <div id="menuList"></div>
    </div>

    <div class="box">
        <h3>üìù L√™n ƒë∆°n</h3>
        <input type="text" id="khTen" list="khSuggestions" placeholder="T√™n kh√°ch" oninput="autoFillClass(this.value)">
        <datalist id="khSuggestions"></datalist>
        <input type="text" id="khLop" placeholder="L·ªõp">
        <select id="khChonMon"></select>
        <input type="number" id="khSL" placeholder="S·ªë l∆∞·ª£ng" value="1">
        <div class="btn-app" style="background:#4caf50;" onpointerdown="addItem(event)">TH√äM M√ìN ƒê·ª¢I</div>
        <div id="orderPreview" style="margin:10px 0; min-height: 30px;"></div>
        <div class="btn-app" onpointerdown="checkout(event)">CH·ªêT ƒê∆†N</div>
    </div>

    <div class="box">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3>üèÜ X·∫øp h·∫°ng</h3>
            <div id="dayFilters" class="filter-container"></div>
        </div>
        <div id="rankList"></div>
        <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
        <h3>üìä T·ªïng k·∫øt</h3>
        <div class="stat-grid">
            <div class="stat-item" style="background: #1976d2;">DOANH THU<br><span id="totalRevenue">0</span></div>
            <div class="stat-item" style="background: #fb8c00;">V·ªêN<br><span id="totalCapital">0</span></div>
            <div class="stat-item" style="background: #43a047;">L√ÉI<br><span id="totalProfit">0</span></div>
        </div>
    </div>
</div>

<script>
    let prods = JSON.parse(localStorage.getItem('8A_prods')) || [];
    let orders = JSON.parse(localStorage.getItem('8A_orders')) || [];
    let cart = []; let filterDay = 'all';

    function save() {
        localStorage.setItem('8A_prods', JSON.stringify(prods));
        localStorage.setItem('8A_orders', JSON.stringify(orders));
    }

    function togglePass(e) { if(e) e.preventDefault(); const p = document.getElementById('passInput'); p.type = p.type==='password'?'text':'password'; }
    function unlock(e) { 
        if(e) e.preventDefault(); 
        if(document.getElementById('passInput').value === 'big family 8A') { 
            document.getElementById('lock-screen').style.display='none'; 
            document.getElementById('app-container').style.display='block';
            renderAll();
        } else alert('M·∫≠t kh·∫©u sai!'); 
    }

    function addProd(e) {
        if(e) e.preventDefault();
        const t = document.getElementById('setupTen').value.trim();
        const b = document.getElementById('setupBan').value;
        const v = document.getElementById('setupVon').value;
        const l = document.getElementById('setupLai').value;
        if(!t || !b) return alert("Vui l√≤ng nh·∫≠p T√™n v√† Gi√°!");
        let nB = parseFloat(b);
        let nV = v!==""?parseFloat(v):(l!==""?nB-parseFloat(l):0);
        let nL = l!==""?parseFloat(l):(v!==""?nB-parseFloat(v):0);
        prods.push({ten:t, ban:nB, von:nV, lai:nL});
        save(); renderMenu();
        document.getElementById('setupTen').value=''; document.getElementById('setupBan').value='';
        document.getElementById('setupVon').value=''; document.getElementById('setupLai').value='';
    }

    function removeProd(index) {
        if(confirm("X√≥a m√≥n n√†y kh·ªèi danh m·ª•c g·ªëc?")) {
            prods.splice(index, 1);
            save(); renderMenu();
        }
    }

    function renderMenu() {
        const list = document.getElementById('menuList');
        const select = document.getElementById('khChonMon');
        list.innerHTML = ''; select.innerHTML = '';
        prods.forEach((p, i) => {
            list.innerHTML += `
                <div class="menu-row">
                    <span>${i+1}. ${p.ten} (${p.ban.toLocaleString()})</span>
                    <button onpointerdown="removeProd(${i})" style="color:red; border:1px solid red; background:none; border-radius:5px; font-size:10px; cursor:pointer;">X√ìA</button>
                </div>`;
            select.innerHTML += `<option value="${i}">${p.ten}</option>`;
        });
    }

    function addItem(e) {
        if(e) e.preventDefault();
        const idx = document.getElementById('khChonMon').value;
        const sl = document.getElementById('khSL').value;
        if(idx==="") return;
        cart.push({...prods[idx], sl: parseInt(sl)});
        renderCartPreview();
    }

    function renderCartPreview() {
        const div = document.getElementById('orderPreview');
        div.innerHTML = cart.map((item, index) => `
            <span class="cart-item">
                ${item.ten} x${item.sl}
                <span class="cart-del" onpointerdown="removeFromCart(${index})">‚úñ</span>
            </span>
        `).join('');
    }

    function removeFromCart(index) {
        cart.splice(index, 1);
        renderCartPreview();
    }

    function checkout(e) {
        if(e) e.preventDefault();
        const ten = document.getElementById('khTen').value.trim();
        const lop = document.getElementById('khLop').value.trim();
        if(!ten || cart.length===0) return alert("Thi·∫øu t√™n ho·∫∑c m√≥n!");
        orders.push({ten, lop, items: [...cart], date: new Date().toLocaleDateString('vi-VN')});
        cart = []; save();
        document.getElementById('orderPreview').innerHTML = '';
        document.getElementById('khTen').value = '';
        document.getElementById('khLop').value = '';
        renderStats(); renderRank(); renderSugg();
    }

    function renderStats() {
        let rev = 0, cap = 0, prof = 0;
        orders.forEach(o => {
            if(filterDay === 'all' || o.date === filterDay) {
                o.items.forEach(i => { rev += i.ban*i.sl; cap += i.von*i.sl; prof += i.lai*i.sl; });
            }
        });
        document.getElementById('totalRevenue').innerText = rev.toLocaleString();
        document.getElementById('totalCapital').innerText = cap.toLocaleString();
        document.getElementById('totalProfit').innerText = prof.toLocaleString();
        const dates = ['all', ...new Set(orders.map(o => o.date))];
        document.getElementById('dayFilters').innerHTML = dates.map(d => `<div class="btn-day ${filterDay===d?'active':''}" onpointerdown="setFilter('${d}')">${d==='all'?'T·∫•t c·∫£':d}</div>`).join('');
    }

    function setFilter(d) { filterDay = d; renderStats(); renderRank(); }

    function renderRank() {
        const summary = {};
        orders.forEach(o => {
            if(filterDay === 'all' || o.date === filterDay) {
                const key = `${o.ten.toLowerCase()}_${o.lop.toLowerCase()}`;
                if(!summary[key]) summary[key] = {ten: o.ten, lop: o.lop, total: 0};
                o.items.forEach(i => summary[key].total += i.ban * i.sl);
            }
        });
        const sorted = Object.values(summary).sort((a,b) => b.total - a.total);
        document.getElementById('rankList').innerHTML = sorted.map((s, i) => `
            <div class="customer-row">
                <span><b>#${i+1}</b> ${s.ten} (${s.lop}): ${s.total.toLocaleString()}</span>
                <button class="btn-history" onpointerdown="showHistory('${s.ten}', '${s.lop}')">XEM</button>
            </div>
        `).join('');
    }

    function showHistory(name, lop) {
        const hist = orders.filter(o => o.ten === name && o.lop === lop);
        document.getElementById('popContent').innerHTML = hist.map((o) => `
            <div style="border-bottom:1px solid #eee; padding:8px 0;">
                <small>${o.date}</small> <button onpointerdown="deleteOrder(${orders.indexOf(o)}, '${name}', '${lop}')" style="color:red; float:right; border:none; background:none; font-weight:bold;">X√≥a</button><br>
                ${o.items.map(i => `${i.ten} x${i.sl}`).join('<br>')}
            </div>
        `).join('');
        document.getElementById('popTitle').innerText = name + " (" + lop + ")";
        document.getElementById('popHistory').style.display = 'block';
    }

    function deleteOrder(idx, name, lop) {
        if(confirm("X√≥a ƒë∆°n n√†y?")) {
            orders.splice(idx, 1); save();
            const still = orders.some(o => o.ten === name && o.lop === lop);
            if(!still) document.getElementById('popHistory').style.display = 'none';
            else showHistory(name, lop);
            renderStats(); renderRank();
        }
    }

    function autoFillClass(n) { const f = orders.find(o => o.ten === n); if(f) document.getElementById('khLop').value = f.lop; }
    function renderSugg() {
        const names = [...new Set(orders.map(o => o.ten))];
        document.getElementById('khSuggestions').innerHTML = names.map(n => `<option value="${n}">`).join('');
    }
    function renderAll() { renderMenu(); renderStats(); renderRank(); renderSugg(); }
</script>
</body>
</html>
